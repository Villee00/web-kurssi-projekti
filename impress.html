<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Document</title>

    <link rel="stylesheet" href="./fonts/stylesheet.css">
    <link rel="stylesheet" href="./css/style.css">

    <script src="./js/kaupungit.js"></script>

    <style>
        .box {
            display: block;
            width: 800px;
            height: 600px;
            padding: 30px 50px;
            background-color: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
            border: 1px solid rgba(0, 0, 0, .3);
            border-radius: 20px;
            text-shadow: 0 2px 2px rgba(0, 0, 0, .1);
            font-family: 'Karla', sans-serif;
            font-size: 40px;
            color: rgb(102, 102, 102);
        }
        pre {
            font-size: 12px;
            line-height: 1.5;
        }
        .koodiOtsikko {
            margin-bottom: 10px;
            margin-top: 10px
        }
        #haeKaupungit {
            width: 1200px;
        }
        #yla {
            height: 700px;
            width: 1100px;
            background: #f96e46;
        }
        #uimapaikat h4{
            margin-bottom: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <nav class="topnav">
        <a href="index.html">Koti</a>
        <a href="detail.html">Hätätapaukset</a>
        <a href="#about">Meistä</a>
    </nav>

    <div id="impress">

        <div class="step box" data-x="1500" data-y="1400" data-scale="3" id="yla"></div>
        <div class="step box" data-x="350" data-y="700">
            <h4>Yleiskuvaus:</h4>
            <ul>
                <li>Uimapaikkojen etsiminen kunnittain.</li>
                <li>Kaikille uimareille. </li>
                <li>Kartta näyttää uimapaikat joka kunnalta. </li>
                <li>Uimahallit, -altaat, ja rannat. </li>
                <li>Kylpylät, maauimalat ja talviuintipaikat.</li>
            </ul>
    
        </div>
        <div class="step box" data-x="350" data-y="1400">
            <ul>
                <li>Ensiksi valitaan kunta.</li>
                <li>Kartta siirtyy kuntaan ja näyttää uimapaikat.</li>
                <li>Samalla poistetaan vanhat merkit. </li>
                <li>Kun klikkaa merkkia saa uimapaikan tiedot. </li>
                <li>Reittiohjeet nappulaa painamalla pääsee Google Mapsiin.</li>
            </ul>
        </div>
        <div class="step box" data-x="350" data-y="2100">
            <h4>Käytetyt APIt</h4>
            <ul>
                <li>Uimapaikkojen haku: http://lipas.cc.jyu.fi/api</li>
                <li>Kuntien haku: https://data.stat.fi/api</li>
                <li>Geokoodaus: http://api.digitransit.fi/geocoding/v1/search</li>
            </ul>
        </div>
        <div class="step box" data-x="1490" data-y="1000" data-rotate="90" id="haeKaupungit">
            <h4 class="koodiOtsikko">Haetaan Suomen kunnat ja lisätään ne valikkoon niitä vastaavien koodien kanssa</h4>
            <pre>
                <code>
                    function haeKaupungit(){
                        fetch(`${proxy}https://data.stat.fi/api/classifications/v2/classifications/kunta_1_20200101/classificationItems?content=data&format=json&lang=fi&meta=max`).
                        then(function(vastaus){
                            return vastaus.json();
                        }).then(function(kaupungit){
                            console.log(kaupungit);
    
                            //lisätään kaupungit uuteen listaan.
                            for (let i = 0; i < kaupungit.length; i++) {
                                const kaupunki = {
                                    kaupunginNimi: kaupungit[i].classificationItemNames[0].name,
                                    kaupunginKoodi: parseInt(kaupungit[i].code)
                                }
                                kaupunkiLista.push(kaupunki);
                            }
                            console.log(kaupunkiLista);
                            //lisätään kaupungit select-valikkoon
                            for (let i = 0; i < kaupunkiLista.length; i++) {
                                const valinta = document.createElement('option');
                                valinta.textContent = kaupunkiLista[i].kaupunginNimi;
                                valinta.value = kaupunkiLista[i].kaupunginKoodi;
                                valikko.appendChild(valinta);
    
                            }
                        });
                    }
                </code>
            </pre>
        </div>
        <div class="step box" data-x="1500" data-y="2100" id="valitseKaupunki">
            <h4>Valitaan uimapaikat kunnittain</h4>
            <pre>
                <code>
                    function valitseKaupunki(koodi, valinta){
                        markkerit.clearLayers();
                        valinta = valikko[valikko.selectedIndex].value;
                        if (valinta != 0) {
                            fetch(
                                `${proxy}http://lipas.cc.jyu.fi/api/sports-places?typeCodes=${koodi}&fields=name&fields=phoneNumber
                                &fields=location.address&fields=location.postalCode&fields=location.city.name&
                                fields=location.coordinates.wgs84&fields=constructionYear&pageSize=100&cityCodes=${valinta}&
                                fields=www&fields=email`).
                            then(function(vastaus) {
                                return vastaus.json();
                            }).then(function(hallit) {
                                uimahallit(hallit);
                            });
                            siirraKarttaa(valinta);
                        }
    
                    }
                </code>
            </pre>
        </div>
        <div class="step box" data-x="2640" data-y="2100">
            <h4>Haetaan uimapaikat koodeittan koodeittan</h4>
            <pre>
                <code>
                    //uimahallien haku koodien eli eri tyyppien mukaan
                    function uimapaikkojenHaku(){
    
                        valitseKaupunki(3110);  // hakee uimahallit
                        valitseKaupunki(3120);  // hakee uima-altaat
                        valitseKaupunki(3130);  // hakee kylpylät
                        valitseKaupunki(3210);  // hakee maauimalat
                        valitseKaupunki(3220);  // hakee uimarannat
                        valitseKaupunki(3230);  // hakee uimapaikat
                        valitseKaupunki(3240);  // hakee talviuintipaikat
    
                    }
                    valikko.addEventListener('change', uimapaikkojenHaku);;
                </code>
            </pre>
        </div>
        <div class="step box" data-x="2640" data-y="1400">
            <h4>Siirretään karttaa kunnan mukaan</h4>
            <pre>
                <code>
                    function siirraKarttaa(valinta){
                      lisaaMarker(paikka, 'Olen tässä');
                      valinta = valikko[valikko.selectedIndex].text;
                      if (valinta != 'Valitse Kaupunki'){
                        fetch(`${proxy}http://api.digitransit.fi/geocoding/v1/search?text=${valinta}`).
                            then(function(vastaus){
                              return vastaus.json();
                            }).then(function(kaupunginKoordinaatit){
                              console.log(kaupunginKoordinaatit);
                              for (let i = 0; i < kaupunginKoordinaatit.features.length; i++) {
                                if (kaupunginKoordinaatit.features[i].properties.localadmin === valinta) {
                                  const koordinaatit = {
                                    lat: kaupunginKoordinaatit.features[i].geometry.coordinates[1],
                                    long: kaupunginKoordinaatit.features[i].geometry.coordinates[0]
                                  }
    
                                  map.flyTo([koordinaatit.lat, koordinaatit.long], 11);
    
                                }
                              }
                        });
                      }
                    }
                </code>
            </pre>
        </div>
        <div class="step box" data-x="2640" data-y="700" id="uimapaikat">
            <h4>Lisätään uimapaikat kartalle</h4>
            <pre>
                <code>
                    function uimahallit(uimahallit){
                      console.log(uimahallit);
                      for (let i = 0; i < uimahallit.length; i++) {
                        const koordinaatit = {
                          latitude: uimahallit[i].location.coordinates.wgs84.lat,
                          longitude: uimahallit[i].location.coordinates.wgs84.lon
                        };
    
                        let tyyppi = uimahallit[i].type.name;
    
                        if (tyyppi == "Uimahalli") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, blueIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Uima-allas") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, orangeIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Kylpylä") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, goldIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Maauimala") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, greenIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Uimaranta") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, yellowIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Uimapaikka") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, greyIcon, false, uimahallit[i]);
                        } else if (tyyppi === "Talviuintipaikka") {
                          lisaaMarker(koordinaatit, uimahallit[i].name, violetIcon, false, uimahallit[i]);
                        } else {
                          lisaaMarker(koordinaatit, uimahallit[i].name, blackIcon, false, uimahallit[i]);
                        }
                      }
                    }
                </code>
            </pre>
        </div>
    
    </div>

    <footer>
        <h3>Ryhmä 7</h3>
    </footer>
    <script src="./js/impress.js"></script>
    <script>
        impress().init();
    </script>
</body>
</html>